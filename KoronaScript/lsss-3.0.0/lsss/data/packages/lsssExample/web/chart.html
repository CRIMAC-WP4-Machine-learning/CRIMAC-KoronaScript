<!DOCTYPE html>
<head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>LSSS example package - Chart</title>
   <style>
      html {
         font-family: sans-serif;
      }
   </style>
</head>
<body>
<h1>LSSS example package - Chart</h1>
<p>
   Example of plotting data from LSSS (the Echogram plot module) using <a href="https://www.chartjs.org/">Chart.js</a>.
   See also other <a href="../doc/index.html#WebPages">web page examples</a>.
</p>
<div id="error" style="color: red;"></div>
<canvas id="chart" style="width: 100%; height: 400px;"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script>
   (function () {
      'use strict';

      function createChart(datasets) {
         const firstDataset = datasets[0];
         const coordinateVariable = firstDataset.coordinateVariable[0];
         let labels = firstDataset[coordinateVariable];
         if (coordinateVariable === 'time') {
            labels = labels.map(value => new Date(value * 1000).toISOString());
         }
         const colors = ['#ff0000', '#0000ff', '#00ff00', '#ffff00', '#ff00ff', '#00ffff'];

         new Chart(document.getElementById('chart'), {
            type: 'line',
            data: {
               labels: labels,
               datasets: datasets.map((ds, i) => {
                  return {
                     label: ds.name,
                     data: ds[ds.dataVariable],
                     borderColor: colors[i % colors.length],
                     pointRadius: 0,
                  };
               })
            },
            options: {
               responsive: true,
               scales: {
                  x: {
                     title: {
                        display: true,
                        text: coordinateVariable,
                     }
                  },
               },
            },
         });
      }

      fetch('/lsss/module/EchogramPlotModule/data')
            .then(response => {
               response.json().then(data => {
                  if (response.status !== 200) {
                     document.getElementById('error').innerText = data.message;
                     return;
                  }
                  const datasets = data.datasets;
                  if (datasets.length === 0) {
                     document.getElementById('error').innerText = 'No data';
                     return;
                  }
                  createChart(datasets);
               });
            });

   })();
</script>
</body>
